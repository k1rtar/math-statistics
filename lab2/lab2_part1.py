import numpy as np
from scipy.stats import t

# Функция для вычисления доверительного интервала
def confidence_interval(n1, n2, mu1, mu2, sigma1, sigma2, alpha=0.05):
    # Генерируем две выборки из нормальных распределений
    X1 = np.random.normal(mu1, sigma1, n1)
    X2 = np.random.normal(mu2, sigma2, n2)
    # Вычисляем разность выборочных средних
    mean_diff = np.mean(X1) - np.mean(X2)
    # Вычисляем выборочные дисперсии
    S1 = np.var(X1, ddof=1)
    S2 = np.var(X2, ddof=1)
    # Вычисляем стандартную ошибку
    se = np.sqrt(S1/n1 + S2/n2)
    # Вычисляем число степеней свободы
    df = n1 + n2 - 2
    # Вычисляем квантиль распределения Стьюдента
    t_value = t.ppf(1 - alpha/2, df)
    # Вычисляем границы доверительного интервала
    lower = mean_diff - t_value * se
    upper = mean_diff + t_value * se
    return lower, upper

# Функция для проведения эксперимента
def experiment(n1, n2, mu1, mu2, sigma1, sigma2, num_trials=1000):
    count = 0
    for _ in range(num_trials):
        # Вычисляем доверительный интервал
        lower, upper = confidence_interval(n1, n2, mu1, mu2, sigma1, sigma2)
        # Проверяем, покрывает ли доверительный интервал истинное значение параметра
        if lower <= (mu1 - mu2) <= upper:
            count += 1
    # Возвращаем долю случаев, когда доверительный интервал покрывает истинное значение параметра
    return count / num_trials

# Запускаем эксперимент для выборок разного объема
n1 = n2 = 25
mu1 = 2
mu2 = 1
sigma1 = sigma2 = 1
coverage_rate_25 = experiment(n1, n2, mu1, mu2, sigma1, sigma2)
print(f"Для выборки объемом {n1}, 95%-ный доверительный интервал покрывает истинное значение параметра в {coverage_rate_25*100}% случаев.")

n1 = n2 = 10000
coverage_rate_10000 = experiment(n1, n2, mu1, mu2, sigma1, sigma2)
print(f"Для выборки объемом {n1}, 95%-ный доверительный интервал покрывает истинное значение параметра в {coverage_rate_10000*100}% случаев.")

print("\nВывод:")
print(f"Доля случаев, когда доверительный интервал покрывает истинное значение параметра, увеличилась с {coverage_rate_25*100}% до {coverage_rate_10000*100}% при увеличении объема выборки с 25 до 10000.")
print("Это связано с тем, что при увеличении объема выборки, выборочные средние становятся более точными оценками средних значений генеральной совокупности, и доверительный интервал становится уже. Следовательно, вероятность того, что доверительный интервал будет содержать истинное значение параметра, увеличивается.")
